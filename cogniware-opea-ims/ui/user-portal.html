<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cogniware Core - User Portal</title>
    <link rel="stylesheet" href="user-portal-enhanced.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            padding: 20px;
            overflow-y: auto;
        }

        .logo {
            font-size: 1.5em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 30px;
        }

        .menu-item {
            padding: 12px 15px;
            margin-bottom: 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
        }

        .menu-item:hover {
            background: #f5f5f5;
        }

        .menu-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .main-content {
            margin-left: 250px;
            padding: 30px;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 1.8em;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #999;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .feature-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 25px;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-card h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .feature-card p {
            color: #666;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .feature-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .workspace {
            display: none;
        }

        .workspace.active {
            display: block;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .input-group input, .input-group textarea, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .result-box {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }

        .code-preview {
            background: #2d2d2d;
            color: #f8f8f8;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .success-message {
            background: #e6f9e6;
            color: #2d862d;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .login-container h2 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f9f9f9;
            color: #667eea;
            font-weight: 600;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
            background: #e6f3ff;
            color: #2d5c86;
        }

        .screenshot-preview {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 15px;
        }

        .nl-input-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .nl-input-bar h3 {
            color: white;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .nl-input-container {
            display: flex;
            gap: 10px;
        }

        .nl-input-container input {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
        }

        .nl-input-container button {
            padding: 15px 30px;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .nl-input-container button:hover {
            transform: translateY(-2px);
        }

        .nl-status {
            margin-top: 10px;
            color: white;
            font-size: 0.9em;
        }

        .llm-indicator {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            font-size: 0.85em;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <h2>üîê Cogniware Core Login</h2>
        <div id="loginAlert" class="error-message" style="display: none;"></div>
        <form id="loginForm">
            <div class="input-group">
                <label>Username</label>
                <input type="text" id="loginUsername" required>
            </div>
            <div class="input-group">
                <label>Password</label>
                <input type="password" id="loginPassword" required>
            </div>
            <button type="submit" class="btn" style="width: 100%;">Login</button>
        </form>
        <div style="text-align: center; margin-top: 20px; color: #999; font-size: 0.9em;">
            Cogniware Incorporated<br>
            User Portal v2.0.0
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">üöÄ Cogniware</div>
            <div class="menu-item active" onclick="showWorkspace('dashboard')">
                üìä Dashboard
            </div>
            <div class="menu-item" onclick="showWorkspace('database')">
                üóÑÔ∏è Database Q&A
            </div>
            <div class="menu-item" onclick="showWorkspace('codegen')">
                üíª Code Generation
            </div>
            <div class="menu-item" onclick="showWorkspace('documents')">
                üìÑ Documents
            </div>
            <div class="menu-item" onclick="showWorkspace('integration')">
                üîÑ Data Integration
            </div>
            <div class="menu-item" onclick="showWorkspace('workflow')">
                ‚öôÔ∏è Workflows
            </div>
            <div class="menu-item" onclick="showWorkspace('browser')">
                üåê Browser Automation
            </div>
            <div class="menu-item" onclick="showWorkspace('rpa')">
                ü§ñ RPA Workflows
            </div>
            <div class="menu-item" onclick="showWorkspace('apikeys')">
                üîë API Keys
            </div>
            <hr style="margin: 20px 0;">
            <div class="menu-item" onclick="logout()" style="color: #ff4444;">
                üö™ Logout
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <div>
                    <h1 id="workspaceTitle">Dashboard</h1>
                    <p style="color: #999;" id="workspaceSubtitle">Welcome to Cogniware Core</p>
                </div>
                <div class="user-info">
                    <div>
                        <div style="font-weight: 600; color: #333;" id="userName">User</div>
                        <div style="font-size: 0.85em; color: #999;" id="userRole">Role</div>
                    </div>
                    <div class="user-avatar" id="userAvatar">U</div>
                </div>
            </div>

            <!-- Dashboard Workspace -->
            <div class="workspace active" id="workspace-dashboard">
                <div class="feature-grid">
                    <div class="feature-card" onclick="showWorkspace('database')">
                        <div class="feature-icon">üóÑÔ∏è</div>
                        <h3>Database Q&A</h3>
                        <p>Query databases using natural language. No SQL knowledge required.</p>
                        <p style="margin-top: 10px;"><strong>ROI: 87% time savings</strong></p>
                    </div>
                    <div class="feature-card" onclick="showWorkspace('codegen')">
                        <div class="feature-icon">üíª</div>
                        <h3>Code Generation</h3>
                        <p>Generate complete projects and functions instantly.</p>
                        <p style="margin-top: 10px;"><strong>ROI: 95% faster development</strong></p>
                    </div>
                    <div class="feature-card" onclick="showWorkspace('documents')">
                        <div class="feature-icon">üìÑ</div>
                        <h3>Document Processing</h3>
                        <p>Create, analyze, and search documents with AI.</p>
                        <p style="margin-top: 10px;"><strong>ROI: 80% search efficiency</strong></p>
                    </div>
                    <div class="feature-card" onclick="showWorkspace('integration')">
                        <div class="feature-icon">üîÑ</div>
                        <h3>Data Integration</h3>
                        <p>Import, export, and transform data from any source.</p>
                        <p style="margin-top: 10px;"><strong>ROI: 90% automation</strong></p>
                    </div>
                    <div class="feature-card" onclick="showWorkspace('workflow')">
                        <div class="feature-icon">‚öôÔ∏è</div>
                        <h3>Workflow Automation</h3>
                        <p>Automate multi-step business processes.</p>
                        <p style="margin-top: 10px;"><strong>ROI: 20 hours/week saved</strong></p>
                    </div>
                    <div class="feature-card" onclick="showWorkspace('browser')">
                        <div class="feature-icon">üåê</div>
                        <h3>Browser Automation</h3>
                        <p>Control Chrome, take screenshots, extract data.</p>
                        <p style="margin-top: 10px;"><strong>ROI: 100% data entry elimination</strong></p>
                    </div>
                    <div class="feature-card" onclick="showWorkspace('rpa')">
                        <div class="feature-icon">ü§ñ</div>
                        <h3>RPA Workflows</h3>
                        <p>Robotic Process Automation for repetitive tasks.</p>
                        <p style="margin-top: 10px;"><strong>ROI: $75K/year savings</strong></p>
                    </div>
                    <div class="feature-card" onclick="showWorkspace('apikeys')">
                        <div class="feature-icon">üîë</div>
                        <h3>API Keys</h3>
                        <p>Manage your API keys for programmatic access.</p>
                        <p style="margin-top: 10px;"><strong>Secure access management</strong></p>
                    </div>
                </div>

                <div class="card" style="margin-top: 30px;">
                    <h2>Getting Started</h2>
                    <ol style="line-height: 2; color: #666;">
                        <li>Create an API key in the "API Keys" section</li>
                        <li>Explore features using the sidebar menu</li>
                        <li>Try each capability with the interactive forms</li>
                        <li>View results in real-time</li>
                        <li>Use the API key for programmatic access</li>
                    </ol>
                </div>
            </div>

            <!-- Database Q&A Workspace -->
            <div class="workspace" id="workspace-database">
                <!-- Natural Language Input -->
                <div class="nl-input-bar">
                    <h3>ü§ñ Natural Language Input <span class="llm-indicator" id="nlDatabaseLLMStatus">MCP Enabled</span></h3>
                    <div class="nl-input-container">
                        <input type="text" id="nlDatabaseInput" placeholder='Ask a question about your data...'>
                        <button onclick="processNaturalLanguage('database', this)">‚ú® Process with CogniDream</button>
                    </div>
                    <div class="nl-status" id="nlDatabaseStatus"></div>
                </div>
                
                <!-- Database Name Input (Required) -->
                <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-top: 20px;">
                    <h3 style="color: white; margin-bottom: 16px;">üóÑÔ∏è Database Name (Required)</h3>
                    <div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 12px;">
                        <input type="text" id="databaseName" placeholder="my_database" 
                               style="padding: 14px; background: white; border: 2px solid #667eea; border-radius: 8px; width: 100%; font-size: 14px;" 
                               value="main_database">
                        <div style="margin-top: 12px; color: #666; font-size: 13px;">
                            Enter the name of the database to query
                        </div>
                    </div>
                </div>
                
                <!-- Examples Section -->
                <div id="databaseExamples"></div>
                
                <div class="card" style="display: none;">
                    <h2>üóÑÔ∏è Database Q&A</h2>
                    <p style="color: #666; margin-bottom: 20px;">Create databases and query them using natural language</p>
                    
                    <h3>Create Database</h3>
                    <div class="input-group">
                        <label>Database Name</label>
                        <input type="text" id="dbName" placeholder="my_database">
                    </div>
                    <div class="input-group">
                        <label>Table Name</label>
                        <input type="text" id="dbTableName" placeholder="users">
                    </div>
                    <div class="input-group">
                        <label>Columns (JSON format)</label>
                        <textarea id="dbColumns" rows="5" placeholder='[{"name": "id", "type": "INTEGER PRIMARY KEY"}, {"name": "name", "type": "TEXT"}]'></textarea>
                    </div>
                    <button class="btn" onclick="createDatabase()">Create Database</button>
                    
                    <hr style="margin: 30px 0;">
                    
                    <h3>Natural Language Query</h3>
                    <div class="input-group">
                        <label>Database</label>
                        <input type="text" id="queryDbName" placeholder="my_database">
                    </div>
                    <div class="input-group">
                        <label>Question (Natural Language)</label>
                        <input type="text" id="queryQuestion" placeholder="Show me all users">
                    </div>
                    <button class="btn" onclick="queryDatabase()">Query Database</button>
                    
                    <div id="dbResult"></div>
                </div>
            </div>

            <!-- Code Generation Workspace -->
            <div class="workspace" id="workspace-codegen">
                <!-- Natural Language Input -->
                <div class="nl-input-bar">
                    <h3>ü§ñ Natural Language Input <span class="llm-indicator" id="nlLLMStatus">Checking LLMs...</span></h3>
                    <div class="nl-input-container">
                        <input type="text" id="nlCodeInput" placeholder='Try: "Create a REST API for credit card processing in Python" or "Generate a function to calculate loan interest"'>
                        <button onclick="processNaturalLanguage('code_generation', this)">‚ú® Process with CogniDream</button>
                    </div>
                    <div class="nl-status" id="nlCodeStatus"></div>
                </div>
                
                <!-- Examples Section -->
                <div id="codegenerationExamples"></div>
                
                <div class="card" style="display: none;">
                    <h2>üíª Code Generation</h2>
                    <p style="color: #666; margin-bottom: 20px;">Generate complete projects and functions instantly</p>
                    
                    <h3>Generate Project</h3>
                    <div class="input-group">
                        <label>Project Name</label>
                        <input type="text" id="projectName" placeholder="my_awesome_api">
                    </div>
                    <div class="input-group">
                        <label>Project Type</label>
                        <select id="projectType">
                            <option value="api">REST API</option>
                            <option value="web">Web Application</option>
                            <option value="cli">CLI Tool</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Language</label>
                        <select id="projectLanguage">
                            <option value="python">Python</option>
                            <option value="javascript">JavaScript</option>
                        </select>
                    </div>
                    <button class="btn" onclick="generateProject()">Generate Project</button>
                    
                    <hr style="margin: 30px 0;">
                    
                    <h3>Generate Function</h3>
                    <div class="input-group">
                        <label>Function Name</label>
                        <input type="text" id="functionName" placeholder="calculate_discount">
                    </div>
                    <div class="input-group">
                        <label>Description</label>
                        <textarea id="functionDesc" rows="3" placeholder="Calculate discount based on customer loyalty and purchase amount"></textarea>
                    </div>
                    <div class="input-group">
                        <label>Language</label>
                        <select id="functionLanguage">
                            <option value="python">Python</option>
                            <option value="javascript">JavaScript</option>
                        </select>
                    </div>
                    <button class="btn" onclick="generateFunction()">Generate Function</button>
                    
                    <div id="codegenResult"></div>
                </div>
            </div>

            <!-- Documents Workspace -->
            <div class="workspace" id="workspace-documents">
                <!-- Natural Language Input -->
                <div class="nl-input-bar">
                    <h3>ü§ñ Natural Language Input <span class="llm-indicator" id="nlDocumentsLLMStatus">MCP Enabled</span></h3>
                    <div class="nl-input-container">
                        <input type="text" id="nlDocumentsInput" placeholder='Ask questions about your documents...'>
                        <button onclick="processNaturalLanguage('documents', this)">‚ú® Process with CogniDream</button>
                    </div>
                    <div class="nl-status" id="nlDocumentsStatus"></div>
                </div>
                
                <!-- File Upload Section -->
                <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-top: 20px;">
                    <h3 style="color: white; margin-bottom: 16px;">üì§ Upload Document (Required)</h3>
                    <div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 12px;">
                        <input type="file" id="docFileUpload" accept=".pdf,.docx,.doc,.xlsx,.xls,.pptx,.ppt,.txt,.md,.csv,.json" 
                               style="padding: 12px; background: white; border: 2px solid #667eea; border-radius: 8px; width: 100%; font-size: 14px;"
                               onchange="handleDocumentUpload(this)">
                        <div id="uploadStatus" style="margin-top: 12px; color: #333; font-size: 14px;"></div>
                        <div style="margin-top: 12px; color: #666; font-size: 13px;">
                            <strong>Supported:</strong> PDF, DOCX, XLSX, PPTX, TXT, MD, CSV, JSON
                        </div>
                    </div>
                </div>
                
                <!-- Examples Section -->
                <div id="documentsExamples"></div>
                
                <div class="card" style="display: none;">
                    <h2>üìÑ Document Processing</h2>
                    <p style="color: #666; margin-bottom: 20px;">Upload and process PDF, DOCX, XLS, XLSX, PPT, PPTX, and text documents</p>
                    
                    <h3>Upload Document</h3>
                    <div class="input-group">
                        <label>Select File</label>
                        <input type="file" id="docFile" accept=".pdf,.docx,.doc,.xlsx,.xls,.pptx,.ppt,.txt,.md,.csv,.json" style="padding: 10px;">
                    </div>
                    <button class="btn" onclick="uploadDocument()">üì§ Upload & Process</button>
                    
                    <div style="background: #f9f9f9; padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <strong>Supported Formats:</strong><br>
                        üìÑ Documents: PDF, DOCX, DOC<br>
                        üìä Spreadsheets: XLSX, XLS, CSV<br>
                        üìΩÔ∏è Presentations: PPTX, PPT<br>
                        üìù Text: TXT, MD, JSON
                    </div>
                    
                    <hr style="margin: 30px 0;">
                    
                    <h3>Create Text Document</h3>
                    <div class="input-group">
                        <label>Document Name</label>
                        <input type="text" id="docName" placeholder="meeting_notes">
                    </div>
                    <div class="input-group">
                        <label>Content</label>
                        <textarea id="docContent" rows="8" placeholder="Enter document content here..."></textarea>
                    </div>
                    <div class="input-group">
                        <label>Type</label>
                        <select id="docType">
                            <option value="txt">Text (.txt)</option>
                            <option value="md">Markdown (.md)</option>
                            <option value="json">JSON (.json)</option>
                            <option value="csv">CSV (.csv)</option>
                        </select>
                    </div>
                    <button class="btn" onclick="createDocument()">Create Document</button>
                    
                    <hr style="margin: 30px 0;">
                    
                    <h3>Search Documents</h3>
                    <div class="input-group">
                        <label>Search Query</label>
                        <input type="text" id="searchQuery" placeholder="budget">
                    </div>
                    <button class="btn" onclick="searchDocuments()">Search</button>
                    
                    <div id="documentsResult"></div>
                </div>
            </div>

            <!-- Data Integration Workspace -->
            <div class="workspace" id="workspace-integration">
                <div class="card">
                    <h2>üîÑ Data Integration & ETL</h2>
                    <p style="color: #666; margin-bottom: 20px;">Import, export, and transform data</p>
                    
                    <h3>Transform Data</h3>
                    <div class="input-group">
                        <label>Input Data (JSON Array)</label>
                        <textarea id="transformData" rows="6" placeholder='[{"name": "john doe", "city": "new york"}, {"name": "jane smith", "city": "los angeles"}]'></textarea>
                    </div>
                    <div class="input-group">
                        <label>Transformation</label>
                        <select id="transformOperation">
                            <option value="uppercase">Convert to Uppercase</option>
                            <option value="lowercase">Convert to Lowercase</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Field to Transform</label>
                        <input type="text" id="transformField" placeholder="name">
                    </div>
                    <button class="btn" onclick="transformData()">Transform Data</button>
                    
                    <div id="integrationResult"></div>
                </div>
            </div>

            <!-- Workflow Automation Workspace -->
            <div class="workspace" id="workspace-workflow">
                <div class="card">
                    <h2>‚öôÔ∏è Workflow Automation</h2>
                    <p style="color: #666; margin-bottom: 20px;">Execute multi-step automated workflows</p>
                    
                    <h3>Create Workflow</h3>
                    <div class="input-group">
                        <label>Workflow Name</label>
                        <input type="text" id="workflowName" placeholder="daily_report">
                    </div>
                    
                    <h4 style="margin: 20px 0 10px 0;">Step 1: HTTP Request</h4>
                    <div class="input-group">
                        <label>URL</label>
                        <input type="text" id="workflowUrl" placeholder="https://api.github.com" value="https://api.github.com">
                    </div>
                    
                    <h4 style="margin: 20px 0 10px 0;">Step 2: Create File</h4>
                    <div class="input-group">
                        <label>File Path</label>
                        <input type="text" id="workflowFilePath" placeholder="reports/workflow_result.txt">
                    </div>
                    <div class="input-group">
                        <label>File Content</label>
                        <textarea id="workflowFileContent" rows="3" placeholder="Workflow executed successfully"></textarea>
                    </div>
                    
                    <button class="btn" onclick="executeWorkflow()">Execute Workflow</button>
                    
                    <div id="workflowResult"></div>
                </div>
            </div>

            <!-- Browser Automation Workspace -->
            <div class="workspace" id="workspace-browser">
                <!-- Natural Language Input -->
                <div class="nl-input-bar">
                    <h3>ü§ñ Natural Language Input <span class="llm-indicator" id="nlBrowserLLMStatus">MCP Enabled</span></h3>
                    <div class="nl-input-container">
                        <input type="text" id="nlBrowserInput" placeholder='Try: "Take a screenshot of google.com" or "Extract data from wikipedia.org"'>
                        <button onclick="processNaturalLanguage('browser', this)">‚ú® Process with CogniDream</button>
                    </div>
                    <div class="nl-status" id="nlBrowserStatus"></div>
                </div>
                
                <!-- URL Input (Required) -->
                <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-top: 20px;">
                    <h3 style="color: white; margin-bottom: 16px;">üåê Website URL (Required)</h3>
                    <div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 12px;">
                        <input type="url" id="browserURL" placeholder="https://example.com" 
                               style="padding: 14px; background: white; border: 2px solid #667eea; border-radius: 8px; width: 100%; font-size: 14px;" 
                               value="https://google.com">
                        <div style="margin-top: 12px; color: #666; font-size: 13px;">
                            Enter the website URL you want to automate
                        </div>
                    </div>
                </div>
                
                <!-- Examples Section -->
                <div id="browserExamples"></div>
                
                <div class="card" style="display: none;">
                    <h2>üåê Browser Automation</h2>
                    <p style="color: #666; margin-bottom: 20px;">Control Chrome browser, take screenshots, extract data</p>
                    
                    <h3>Navigate & Screenshot</h3>
                    <div class="input-group">
                        <label>URL</label>
                        <input type="text" id="browserUrl" placeholder="https://example.com" value="https://example.com">
                    </div>
                    <button class="btn" onclick="navigateAndScreenshot()">Navigate & Take Screenshot</button>
                    
                    <hr style="margin: 30px 0;">
                    
                    <h3>Extract Text from Element</h3>
                    <div class="input-group">
                        <label>CSS Selector</label>
                        <input type="text" id="extractSelector" placeholder="h1">
                    </div>
                    <button class="btn" onclick="extractText()">Extract Text</button>
                    
                    <div id="browserResult"></div>
                </div>
            </div>

            <!-- RPA Workspace -->
            <div class="workspace" id="workspace-rpa">
                <div class="card">
                    <h2>ü§ñ RPA Workflows</h2>
                    <p style="color: #666; margin-bottom: 20px;">Robotic Process Automation for complex tasks</p>
                    
                    <h3>Data Extraction Workflow</h3>
                    <div class="input-group">
                        <label>Target URL</label>
                        <input type="text" id="rpaUrl" placeholder="https://example.com">
                    </div>
                    <div class="input-group">
                        <label>CSS Selectors (comma-separated)</label>
                        <input type="text" id="rpaSelectors" placeholder="h1, .price, .description">
                    </div>
                    <button class="btn" onclick="executeRPAExtraction()">Extract Data</button>
                    
                    <hr style="margin: 30px 0;">
                    
                    <h3>Batch Screenshot Workflow</h3>
                    <div class="input-group">
                        <label>URLs (one per line)</label>
                        <textarea id="rpaBatchUrls" rows="5" placeholder="https://example.com&#10;https://github.com"></textarea>
                    </div>
                    <button class="btn" onclick="executeBatchScreenshots()">Take Batch Screenshots</button>
                    
                    <div id="rpaResult"></div>
                </div>
            </div>

            <!-- API Keys Workspace -->
            <div class="workspace" id="workspace-apikeys">
                <div class="card">
                    <h2>üîë API Keys</h2>
                    <p style="color: #666; margin-bottom: 20px;">Manage your API keys for programmatic access</p>
                    
                    <h3>Create New API Key</h3>
                    <div class="input-group">
                        <label>Key Name</label>
                        <input type="text" id="apiKeyName" placeholder="Production Key">
                    </div>
                    <div class="input-group">
                        <label>Permissions</label>
                        <div>
                            <label><input type="checkbox" value="read" checked> Read</label>
                            <label><input type="checkbox" value="write" checked> Write</label>
                            <label><input type="checkbox" value="admin"> Admin</label>
                        </div>
                    </div>
                    <button class="btn" onclick="createAPIKey()">Create API Key</button>
                    
                    <div id="apiKeyResult"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_ADMIN = 'http://localhost:8099';
        const API_BUSINESS = 'http://localhost:8096';
        let currentToken = null;
        let currentUser = null;

        // Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${API_ADMIN}/auth/login`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username, password})
                });

                const data = await response.json();

                if (data.success) {
                    currentToken = data.token;
                    currentUser = data.user;
                    
                    // Store license key if available
                    if (data.license_key) {
                        window.userLicenseKey = data.license_key;
                        sessionStorage.setItem('cogniware_license', data.license_key);
                    }
                    
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('mainApp').style.display = 'block';
                    
                    document.getElementById('userName').textContent = currentUser.full_name;
                    document.getElementById('userRole').textContent = currentUser.role;
                    document.getElementById('userAvatar').textContent = currentUser.full_name.charAt(0).toUpperCase();
                    
                    // Create API key for the user automatically
                    await ensureAPIKey();
                } else {
                    showLoginError('Invalid credentials');
                }
            } catch (error) {
                showLoginError('Connection error. Make sure servers are running.');
            }
        });

        function showLoginError(message) {
            const alert = document.getElementById('loginAlert');
            alert.textContent = message;
            alert.style.display = 'block';
        }

        function logout() {
            currentToken = null;
            currentUser = null;
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('loginPassword').value = '';
        }

        async function apiCall(endpoint, method = 'GET', body = null, useBusinessAPI = true) {
            const baseURL = useBusinessAPI ? API_BUSINESS : API_ADMIN;
            
            // For business API, we need to get or create an API key first
            if (useBusinessAPI && !window.userAPIKey) {
                // Try to get API key for this user
                await ensureAPIKey();
            }
            
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json'
                }
            };
            
            // Use API key for business API, JWT for admin API
            if (useBusinessAPI && window.userAPIKey) {
                options.headers['X-API-Key'] = window.userAPIKey;
            } else {
                options.headers['Authorization'] = `Bearer ${currentToken}`;
            }

            if (body) {
                options.body = JSON.stringify(body);
            }

            const response = await fetch(`${baseURL}${endpoint}`, options);
            return await response.json();
        }
        
        async function ensureAPIKey() {
            // Check if we already have an API key in session
            const savedKey = sessionStorage.getItem('cogniware_api_key');
            if (savedKey) {
                window.userAPIKey = savedKey;
                return;
            }
            
            if (window.userAPIKey) {
                return;
            }
            
            // Try to create an API key for the user
            try {
                const requestBody = {
                    name: 'User Portal Auto-Generated Key',
                    permissions: ['read', 'write'],
                    days_valid: 365
                };
                
                // Add license key if available
                if (window.userLicenseKey) {
                    requestBody.license_key = window.userLicenseKey;
                }
                
                const result = await fetch(`${API_ADMIN}/admin/api-keys`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await result.json();
                
                if (data.success && data.api_key) {
                    window.userAPIKey = data.api_key;
                    sessionStorage.setItem('cogniware_api_key', data.api_key);
                    console.log('‚úÖ API key created successfully');
                } else {
                    console.error('Failed to create API key:', data);
                    // Show error message to user
                    alert('‚ö†Ô∏è Could not create API key. You may need a valid license.\n\nError: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Failed to create API key:', error);
                alert('‚ö†Ô∏è Connection error while creating API key. Please try again.');
            }
        }

        function showWorkspace(name) {
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.querySelectorAll('.workspace').forEach(w => w.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`workspace-${name}`).classList.add('active');
            
            const titles = {
                'dashboard': 'Dashboard',
                'database': 'Database Q&A',
                'codegen': 'Code Generation',
                'documents': 'Document Processing',
                'integration': 'Data Integration',
                'workflow': 'Workflow Automation',
                'browser': 'Browser Automation',
                'rpa': 'RPA Workflows',
                'apikeys': 'API Keys'
            };
            
            document.getElementById('workspaceTitle').textContent = titles[name];
        }

        // Database Functions
        async function createDatabase() {
            try {
                const columns = JSON.parse(document.getElementById('dbColumns').value);
                const schema = {};
                schema[document.getElementById('dbTableName').value] = columns;
                
                const result = await apiCall('/api/database/create', 'POST', {
                    name: document.getElementById('dbName').value,
                    schema: schema
                });
                
                displayResult('dbResult', result);
            } catch (error) {
                displayError('dbResult', error.message);
            }
        }

        async function queryDatabase() {
            const result = await apiCall('/api/database/query', 'POST', {
                database: document.getElementById('queryDbName').value,
                question: document.getElementById('queryQuestion').value
            });
            
            displayResult('dbResult', result);
        }

        // Code Generation Functions
        async function generateProject() {
            const result = await apiCall('/api/code/project/create', 'POST', {
                name: document.getElementById('projectName').value,
                type: document.getElementById('projectType').value,
                language: document.getElementById('projectLanguage').value
            });
            
            displayResult('codegenResult', result);
        }

        async function generateFunction() {
            const result = await apiCall('/api/code/function/generate', 'POST', {
                name: document.getElementById('functionName').value,
                description: document.getElementById('functionDesc').value,
                language: document.getElementById('functionLanguage').value
            });
            
            if (result.success && result.code) {
                document.getElementById('codegenResult').innerHTML = `
                    <div class="success-message">‚úÖ Function generated successfully!</div>
                    <div class="code-preview">${escapeHtml(result.code)}</div>
                `;
            } else {
                displayResult('codegenResult', result);
            }
        }

        // Document Functions
        async function uploadDocument() {
            const fileInput = document.getElementById('docFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file first');
                return;
            }
            
            // Show uploading message
            document.getElementById('documentsResult').innerHTML = `
                <div class="result-box">
                    <h4>üì§ Uploading and processing...</h4>
                    <p>File: ${file.name}</p>
                    <p>Size: ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                    <p style="color: #667eea;">Please wait...</p>
                </div>
            `;
            
            // Read file as base64
            const reader = new FileReader();
            reader.onload = async function(e) {
                const base64Data = e.target.result.split(',')[1];  // Remove data:...;base64, prefix
                
                try {
                    // Upload document
                    const uploadResult = await apiCall('/api/documents/upload', 'POST', {
                        filename: file.name,
                        file_data: base64Data,
                        type: file.name.split('.').pop().toLowerCase()
                    });
                    
                    if (uploadResult.success) {
                        // Process the uploaded document
                        const processResult = await apiCall(`/api/documents/process/${file.name}`, 'GET');
                        displayDocumentProcessResult('documentsResult', processResult);
                    } else {
                        displayResult('documentsResult', uploadResult);
                    }
                } catch (error) {
                    displayError('documentsResult', error.message);
                }
            };
            
            reader.readAsDataURL(file);
        }
        
        async function createDocument() {
            const result = await apiCall('/api/documents/create', 'POST', {
                name: document.getElementById('docName').value,
                content: document.getElementById('docContent').value,
                type: document.getElementById('docType').value
            });
            
            displayResult('documentsResult', result);
        }

        async function searchDocuments() {
            const result = await apiCall('/api/documents/search', 'POST', {
                query: document.getElementById('searchQuery').value
            });
            
            displayResult('documentsResult', result);
        }
        
        function displayDocumentProcessResult(elementId, result) {
            const container = document.getElementById(elementId);
            let html = '<div class="result-box">';
            
            if (result.success) {
                html += '<h4 style="margin-bottom: 15px;">‚úÖ Document Processed Successfully!</h4>';
                html += `<p style="color: #2d862d; font-size: 1.2em;"><strong>${result.filename}</strong></p>`;
                html += `<p><strong>Type:</strong> <span class="badge" style="background: #e6f3ff; color: #2d5c86;">${result.type.toUpperCase()}</span></p>`;
                html += `<p><strong>Size:</strong> ${(result.size_bytes / 1024).toFixed(2)} KB</p>`;
                
                if (result.page_count) {
                    html += `<p><strong>Pages:</strong> ${result.page_count}</p>`;
                }
                if (result.slide_count) {
                    html += `<p><strong>Slides:</strong> ${result.slide_count}</p>`;
                }
                if (result.sheet_count) {
                    html += `<p><strong>Sheets:</strong> ${result.sheet_count}</p>`;
                }
                if (result.word_count) {
                    html += `<p><strong>Words:</strong> ${result.word_count.toLocaleString()}</p>`;
                }
                if (result.char_count) {
                    html += `<p><strong>Characters:</strong> ${result.char_count.toLocaleString()}</p>`;
                }
                
                // Show text preview for text-based documents
                if (result.text) {
                    html += '<h4 style="margin-top: 20px;">üìÑ Text Preview:</h4>';
                    html += `<div style="background: white; padding: 15px; border-radius: 8px; max-height: 300px; overflow-y: auto; border: 1px solid #ddd;">
                        <pre style="white-space: pre-wrap; word-wrap: break-word; font-family: inherit;">${result.text.substring(0, 1000)}${result.text.length > 1000 ? '...' : ''}</pre>
                    </div>`;
                }
                
                // Show Excel sheets
                if (result.sheets) {
                    html += '<h4 style="margin-top: 20px;">üìä Excel Sheets:</h4>';
                    for (const [sheetName, sheetData] of Object.entries(result.sheets)) {
                        html += `<div style="margin-top: 15px;">`;
                        html += `<h5>${sheetName} (${sheetData.row_count} rows √ó ${sheetData.column_count} columns)</h5>`;
                        
                        if (sheetData.data && sheetData.data.length > 0) {
                            html += '<table style="width: 100%; margin-top: 10px; background: white; font-size: 0.9em;"><tbody>';
                            sheetData.data.slice(0, 10).forEach(row => {
                                html += '<tr>';
                                row.forEach(cell => {
                                    html += `<td style="padding: 8px; border: 1px solid #ddd;">${cell !== null ? cell : ''}</td>`;
                                });
                                html += '</tr>';
                            });
                            html += '</tbody></table>';
                            if (sheetData.data.length > 10) {
                                html += `<p style="color: #999; font-size: 0.85em; margin-top: 5px;">Showing first 10 of ${sheetData.data.length} rows</p>`;
                            }
                        }
                        html += `</div>`;
                    }
                }
                
                // Show PowerPoint slides
                if (result.slides) {
                    html += '<h4 style="margin-top: 20px;">üìΩÔ∏è Slides:</h4>';
                    result.slides.slice(0, 5).forEach(slide => {
                        html += `
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #667eea;">
                                <strong>Slide ${slide.slide_number}</strong><br>
                                <p style="margin-top: 10px; white-space: pre-wrap;">${slide.text}</p>
                            </div>
                        `;
                    });
                    if (result.slides.length > 5) {
                        html += `<p style="color: #999;">Showing first 5 of ${result.slides.length} slides</p>`;
                    }
                }
                
            } else {
                html += `<div class="error-message">‚ùå Error: ${result.error}</div>`;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Integration Functions
        async function transformData() {
            try {
                const data = JSON.parse(document.getElementById('transformData').value);
                const result = await apiCall('/api/integration/transform', 'POST', {
                    data: data,
                    transformations: [{
                        operation: document.getElementById('transformOperation').value,
                        field: document.getElementById('transformField').value
                    }]
                });
                
                displayResult('integrationResult', result);
            } catch (error) {
                displayError('integrationResult', error.message);
            }
        }

        // Workflow Functions
        async function executeWorkflow() {
            const workflow = {
                name: document.getElementById('workflowName').value,
                steps: [
                    {
                        name: 'fetch_data',
                        type: 'http_request',
                        url: document.getElementById('workflowUrl').value
                    },
                    {
                        name: 'create_file',
                        type: 'create_file',
                        path: document.getElementById('workflowFilePath').value,
                        content: document.getElementById('workflowFileContent').value
                    }
                ]
            };
            
            const result = await apiCall('/api/workflow/execute', 'POST', workflow);
            displayResult('workflowResult', result);
        }

        // Browser Automation Functions
        async function navigateAndScreenshot() {
            const url = document.getElementById('browserUrl').value;
            
            // Navigate
            const navResult = await apiCall('/api/browser/navigate', 'POST', {url});
            
            if (navResult.success) {
                // Take screenshot
                const screenshotResult = await apiCall('/api/browser/screenshot', 'POST', {
                    filename: `page_${Date.now()}.png`
                });
                
                displayResult('browserResult', {
                    navigation: navResult,
                    screenshot: screenshotResult
                });
            } else {
                displayResult('browserResult', navResult);
            }
        }

        async function extractText() {
            const result = await apiCall('/api/browser/extract-text', 'POST', {
                selector: document.getElementById('extractSelector').value
            });
            
            displayResult('browserResult', result);
        }

        // RPA Functions
        async function executeRPAExtraction() {
            const selectors = document.getElementById('rpaSelectors').value.split(',').map(s => s.trim());
            
            const result = await apiCall('/api/rpa/extract-data', 'POST', {
                url: document.getElementById('rpaUrl').value,
                selectors: selectors
            });
            
            displayResult('rpaResult', result);
        }

        async function executeBatchScreenshots() {
            const urls = document.getElementById('rpaBatchUrls').value.split('\n').filter(u => u.trim());
            
            const result = await apiCall('/api/rpa/screenshot-batch', 'POST', {
                urls: urls
            });
            
            displayResult('rpaResult', result);
        }

        // API Key Functions
        async function createAPIKey() {
            const permissions = [];
            document.querySelectorAll('#workspace-apikeys input[type="checkbox"]:checked').forEach(cb => {
                permissions.push(cb.value);
            });
            
            const result = await apiCall('/admin/api-keys', 'POST', {
                name: document.getElementById('apiKeyName').value,
                permissions: permissions,
                license_key: currentUser.license_key || '',
                days_valid: 365
            }, false);
            
            if (result.success) {
                document.getElementById('apiKeyResult').innerHTML = `
                    <div class="success-message">
                        ‚úÖ API Key Created Successfully!<br><br>
                        <strong>API Key:</strong><br>
                        <code style="background: #333; color: #0f0; padding: 10px; display: block; margin: 10px 0; border-radius: 6px;">${result.api_key}</code>
                        <br>
                        <strong>‚ö†Ô∏è Save this key! It won't be shown again.</strong><br><br>
                        <strong>Usage:</strong><br>
                        <code style="display: block; background: #f5f5f5; padding: 10px; margin-top: 5px; border-radius: 6px;">
                        curl http://localhost:8096/api/database/query \\<br>
                        &nbsp;&nbsp;-H "X-API-Key: ${result.api_key}" \\<br>
                        &nbsp;&nbsp;-d '{"database":"my_db","question":"Show all users"}'
                        </code>
                    </div>
                `;
            } else {
                displayResult('apiKeyResult', result);
            }
        }

        // Utility Functions
        function displayResult(elementId, result) {
            const container = document.getElementById(elementId);
            let html = '<div class="result-box">';
            
            // Check for screenshot in result
            if (result.screenshot && result.screenshot.image_base64) {
                html += '<h4 style="margin-bottom: 15px;">üì∏ Screenshot:</h4>';
                html += `<img src="data:image/png;base64,${result.screenshot.image_base64}" class="screenshot-preview" style="max-width: 100%; border: 2px solid #667eea; border-radius: 8px; margin-bottom: 20px;">`;
                html += `<p style="color: #666;"><strong>File:</strong> ${result.screenshot.filepath}</p>`;
                
                if (result.navigation) {
                    html += `<p style="color: #666;"><strong>Page Title:</strong> ${result.navigation.title}</p>`;
                    html += `<p style="color: #666;"><strong>URL:</strong> ${result.navigation.url}</p>`;
                }
            }
            
            // Check for code generation result
            else if (result.success && result.code) {
                html += '<h4 style="margin-bottom: 15px;">‚úÖ Function Generated:</h4>';
                html += `<div class="code-preview">${escapeHtml(result.code)}</div>`;
                html += `<button class="btn" style="margin-top: 15px;" onclick="copyToClipboard(\`${escapeHtml(result.code).replace(/`/g, '\\`')}\`)">üìã Copy Code</button>`;
            }
            
            // Check for project generation
            else if (result.success && result.files_created) {
                html += '<h4 style="margin-bottom: 15px;">‚úÖ Project Created Successfully!</h4>';
                html += `<p style="color: #2d862d; font-size: 1.2em; margin-bottom: 15px;"><strong>Project: ${result.project}</strong></p>`;
                html += `<p><strong>Type:</strong> ${result.type}</p>`;
                html += `<p><strong>Language:</strong> ${result.language}</p>`;
                html += `<p><strong>Location:</strong> <code>${result.path}</code></p>`;
                html += '<p style="margin-top: 15px;"><strong>Files Created:</strong></p>';
                html += '<ul style="margin-left: 20px;">';
                result.files_created.forEach(file => {
                    html += `<li><code>${file}</code></li>`;
                });
                html += '</ul>';
                html += `<button class="btn" style="margin-top: 15px;" onclick="alert('Project location:\\n${result.path}')">üìÇ Show Location</button>`;
            }
            
            // Check for database creation
            else if (result.success && result.database && result.tables) {
                html += '<h4 style="margin-bottom: 15px;">‚úÖ Database Created Successfully!</h4>';
                html += `<p style="color: #2d862d; font-size: 1.2em;"><strong>Database: ${result.database}</strong></p>`;
                html += `<p><strong>Location:</strong> <code>${result.path}</code></p>`;
                html += '<p style="margin-top: 15px;"><strong>Tables Created:</strong></p>';
                html += '<ul style="margin-left: 20px;">';
                result.tables.forEach(table => {
                    html += `<li>${table}</li>`;
                });
                html += '</ul>';
            }
            
            // Check for database query results
            else if (result.success && result.sql_generated) {
                html += '<h4 style="margin-bottom: 15px;">‚úÖ Query Executed:</h4>';
                html += `<p><strong>Question:</strong> ${result.question}</p>`;
                html += `<p><strong>SQL Generated:</strong></p>`;
                html += `<div class="code-preview">${result.sql_generated}</div>`;
                
                if (result.results && result.results.length > 0) {
                    html += '<p style="margin-top: 20px;"><strong>Results:</strong></p>';
                    html += '<table style="width: 100%; margin-top: 10px; background: white;"><thead><tr>';
                    result.columns.forEach(col => {
                        html += `<th style="background: #f9f9f9; padding: 10px; border: 1px solid #ddd;">${col}</th>`;
                    });
                    html += '</tr></thead><tbody>';
                    result.results.forEach(row => {
                        html += '<tr>';
                        row.forEach(cell => {
                            html += `<td style="padding: 10px; border: 1px solid #ddd;">${cell}</td>`;
                        });
                        html += '</tr>';
                    });
                    html += '</tbody></table>';
                    html += `<p style="color: #666; margin-top: 10px;"><strong>Row Count:</strong> ${result.row_count}</p>`;
                } else {
                    html += '<p style="color: #999; margin-top: 15px;">No results found</p>';
                }
            }
            
            // Check for document creation
            else if (result.success && result.document) {
                html += '<h4 style="margin-bottom: 15px;">‚úÖ Document Created!</h4>';
                html += `<p><strong>Document:</strong> ${result.document}</p>`;
                html += `<p><strong>Location:</strong> <code>${result.path}</code></p>`;
                html += `<p><strong>Size:</strong> ${result.size} bytes</p>`;
            }
            
            // Check for search results
            else if (result.success && result.results) {
                html += '<h4 style="margin-bottom: 15px;">üîç Search Results:</h4>';
                html += `<p><strong>Query:</strong> "${result.query}"</p>`;
                html += `<p><strong>Matches Found:</strong> ${result.match_count}</p>`;
                
                if (result.results.length > 0) {
                    html += '<div style="margin-top: 15px;">';
                    result.results.forEach(doc => {
                        html += `
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #667eea;">
                                <strong>${doc.document}</strong><br>
                                <code style="font-size: 0.85em; color: #666;">${doc.path}</code><br>
                                <span style="color: #667eea;">${doc.matches} match(es)</span>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
            }
            
            // Check for workflow results
            else if (result.success && result.workflow) {
                html += '<h4 style="margin-bottom: 15px;">‚úÖ Workflow Executed!</h4>';
                html += `<p><strong>Workflow:</strong> ${result.workflow}</p>`;
                html += `<p><strong>Steps:</strong> ${result.steps_executed}</p>`;
                
                if (result.results) {
                    html += '<div style="margin-top: 15px;">';
                    result.results.forEach((step, index) => {
                        const icon = step.success ? '‚úÖ' : '‚ùå';
                        html += `
                            <div style="background: ${step.success ? '#e6f9e6' : '#fee'}; padding: 10px; border-radius: 6px; margin-bottom: 8px;">
                                ${icon} <strong>Step ${index + 1}:</strong> ${step.step} (${step.type})
                            </div>
                        `;
                    });
                    html += '</div>';
                }
            }
            
            // Check for transformation results
            else if (result.success && result.transformed_count !== undefined) {
                html += '<h4 style="margin-bottom: 15px;">‚úÖ Data Transformed!</h4>';
                html += `<p><strong>Records:</strong> ${result.original_count} ‚Üí ${result.transformed_count}</p>`;
                
                if (result.data && result.data.length > 0) {
                    html += '<p style="margin-top: 15px;"><strong>Transformed Data:</strong></p>';
                    html += '<table style="width: 100%; margin-top: 10px; background: white;"><thead><tr>';
                    
                    // Get columns from first object
                    const keys = Object.keys(result.data[0]);
                    keys.forEach(key => {
                        html += `<th style="background: #f9f9f9; padding: 10px; border: 1px solid #ddd;">${key}</th>`;
                    });
                    html += '</tr></thead><tbody>';
                    
                    result.data.forEach(row => {
                        html += '<tr>';
                        keys.forEach(key => {
                            html += `<td style="padding: 10px; border: 1px solid #ddd;">${row[key]}</td>`;
                        });
                        html += '</tr>';
                    });
                    html += '</tbody></table>';
                }
            }
            
            // Check for RPA extraction results
            else if (result.success && result.data && result.workflow === 'data_extraction') {
                html += '<h4 style="margin-bottom: 15px;">‚úÖ Data Extracted!</h4>';
                html += `<p><strong>URL:</strong> ${result.url}</p>`;
                html += `<p><strong>Items Extracted:</strong> ${result.items_extracted}</p>`;
                html += '<div style="margin-top: 15px; background: white; padding: 15px; border-radius: 8px;">';
                
                for (const [selector, value] of Object.entries(result.data)) {
                    html += `<p><strong>${selector}:</strong> ${value || 'Not found'}</p>`;
                }
                html += '</div>';
            }
            
            // Check for batch screenshots
            else if (result.success && result.screenshots) {
                html += '<h4 style="margin-bottom: 15px;">‚úÖ Screenshots Captured!</h4>';
                html += `<p><strong>Count:</strong> ${result.count} pages</p>`;
                html += '<div style="margin-top: 15px;">';
                
                result.screenshots.forEach(screenshot => {
                    html += `
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <p><strong>URL:</strong> ${screenshot.url}</p>
                            <p><strong>File:</strong> <code>${screenshot.filename}</code></p>
                            <p><strong>Path:</strong> <code>${screenshot.filepath}</code></p>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Default: show JSON
            else {
                html += '<h4 style="margin-bottom: 15px;">Result:</h4>';
                
                if (result.success) {
                    html += '<div class="success-message">‚úÖ Operation completed successfully!</div>';
                }
                
                html += `<pre style="white-space: pre-wrap; word-wrap: break-word; background: #f9f9f9; padding: 15px; border-radius: 8px; margin-top: 15px;">${JSON.stringify(result, null, 2)}</pre>`;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function displayError(elementId, message) {
            document.getElementById(elementId).innerHTML = `
                <div class="error-message">‚ùå Error: ${message}</div>
            `;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Code copied to clipboard!');
            }).catch(err => {
                alert('Failed to copy: ' + err);
            });
        }
        
        // Download code to file
        function downloadCode(code, filename = 'generated_code.py') {
            const blob = new Blob([code], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        
        // Document Upload Handler
        let uploadedDocumentName = null;
        
        function handleDocumentUpload(input) {
            const file = input.files[0];
            if (!file) return;
            
            const statusDiv = document.getElementById('uploadStatus');
            statusDiv.innerHTML = '<div style="color: #667eea;">üì§ Uploading ' + file.name + '...</div>';
            
            const formData = new FormData();
            formData.append('file', file);
            
            fetch('http://localhost:8090/api/documents/upload', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${currentToken}`
                },
                body: formData
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    uploadedDocumentName = result.document_name || file.name;
                    statusDiv.innerHTML = '<div style="color: #2d862d; font-weight: 600;">‚úÖ ' + file.name + ' uploaded successfully!</div>';
                } else {
                    statusDiv.innerHTML = '<div style="color: #c33;">‚ùå Upload failed: ' + (result.error || 'Unknown error') + '</div>';
                    uploadedDocumentName = null;
                }
            })
            .catch(error => {
                statusDiv.innerHTML = '<div style="color: #c33;">‚ùå Upload error: ' + error.message + '</div>';
                uploadedDocumentName = null;
            });
        }
        
        // Natural Language Processing Functions
        let llmStatus = {interface: 0, knowledge: 0};
        
        async function checkLLMAvailability() {
            try {
                // Call production server (8090) for LLM availability
                const response = await fetch('http://localhost:8090/api/nl/llms/available', {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });
                const result = await response.json();
                
                if (result.success) {
                    llmStatus.interface = result.llms.interface_llms.length;
                    llmStatus.knowledge = result.llms.knowledge_llms.length;
                    
                    const statusText = llmStatus.interface > 0 || llmStatus.knowledge > 0 ?
                        `${llmStatus.interface} Interface + ${llmStatus.knowledge} Knowledge LLMs` :
                        'No LLMs (Pattern Matching Mode)';
                    
                    document.querySelectorAll('[id$="LLMStatus"]').forEach(el => {
                        el.textContent = statusText;
                        el.style.background = llmStatus.interface > 0 ? 'rgba(76, 175, 80, 0.3)' : 'rgba(255, 152, 0, 0.3)';
                    });
                }
            } catch (error) {
                console.error('Error checking LLMs:', error);
                // Fallback: show pattern matching mode
                document.querySelectorAll('[id$="LLMStatus"]').forEach(el => {
                    el.textContent = 'Pattern Matching Mode';
                    el.style.background = 'rgba(255, 152, 0, 0.3)';
                });
            }
        }
        
        async function processNaturalLanguage(module, buttonElement) {
            // Map modules to their input fields
            const moduleConfig = {
                'code_generation': {input: 'nlCodeInput', status: 'nlCodeStatus', result: 'codegenResult', button: 'btnProcessCode'},
                'browser': {input: 'nlBrowserInput', status: 'nlBrowserStatus', result: 'browserResult', button: 'btnProcessBrowser'},
                'database': {input: 'nlDatabaseInput', status: 'nlDatabaseStatus', result: 'dbResult', button: 'btnProcessDB'},
                'documents': {input: 'nlDocumentsInput', status: 'nlDocumentsStatus', result: 'documentsResult', button: 'btnProcessDocs'}
            };
            
            const config = moduleConfig[module];
            if (!config) return;
            
            const instruction = document.getElementById(config.input).value;
            if (!instruction.trim()) {
                alert('Please enter an instruction');
                return;
            }
            
            // Get button element
            if (!buttonElement) {
                buttonElement = event.target;
            }
            
            // Disable button and add loading class
            buttonElement.disabled = true;
            buttonElement.classList.add('btn-processing');
            const originalText = buttonElement.innerHTML;
            buttonElement.innerHTML = '‚öôÔ∏è Processing...';
            
            // Clear previous results
            document.getElementById(config.result).innerHTML = '';
            
            // Create enhanced visualizer if it doesn't exist
            if (!window.nlVisualizer) {
                // Create visualization container if needed
                if (!document.getElementById('nlVisualization')) {
                    const vizContainer = document.createElement('div');
                    vizContainer.id = 'nlVisualization';
                    document.getElementById(config.status).appendChild(vizContainer);
                }
                window.nlVisualizer = new EnhancedParallelLLMVisualizer('nlVisualization');
            }
            
            // Show parallel execution visualization
            const numInterface = Math.min(llmStatus.interface, 2);
            const numKnowledge = Math.min(llmStatus.knowledge, 1);
            
            window.nlVisualizer.showParallelExecution(numInterface, numKnowledge);
            
            try {
                // Prepare request data with module-specific fields
                const requestData = {
                    instruction: instruction,
                    use_parallel: true,
                    strategy: 'parallel',  // Patent-compliant parallel execution
                    num_interface_llms: numInterface,
                    num_knowledge_llms: numKnowledge,
                    module: module
                };
                
                // Add module-specific required fields
                if (module === 'browser') {
                    const url = document.getElementById('browserURL').value;
                    if (!url) {
                        alert('Please enter a URL for browser automation');
                        throw new Error('URL required');
                    }
                    requestData.url = url;
                }
                
                if (module === 'database') {
                    const dbName = document.getElementById('databaseName').value;
                    if (!dbName) {
                        alert('Please enter a database name');
                        throw new Error('Database name required');
                    }
                    requestData.database = dbName;
                }
                
                if (module === 'documents') {
                    if (!uploadedDocumentName) {
                        alert('Please upload a document first');
                        throw new Error('Document upload required');
                    }
                    requestData.document = uploadedDocumentName;
                }
                
                // Call Production server for natural language processing with parallel LLMs
                const response = await fetch('http://localhost:8090/api/nl/process', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const nlResult = await response.json();
                
                // Show result with visualization
                window.nlVisualizer.showResult(nlResult);
                
                if (nlResult.success) {
                    // Display the generated output in the result area
                    const output = nlResult.generated_output || nlResult.generated_code || nlResult.result || '';
                    const escOutput = escapeHtml(output);
                    
                    let resultHTML = `
                        <div style="background: white; padding: 24px; border-radius: 12px; border: 2px solid #2d862d; margin-top: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                <h4 style="color: #2d862d; margin: 0;">‚úÖ ${module === 'code_generation' ? 'Code Generated Successfully' : 'Processing Complete'}</h4>
                                <div>
                    `;
                    
                    // Add copy button
                    resultHTML += `<button onclick="copyToClipboard(\`${escOutput.replace(/`/g, '\\`')}\`)" 
                                    style="padding: 8px 16px; margin-right: 8px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                                    üìã Copy
                                   </button>`;
                    
                    // Add download button for code generation
                    if (module === 'code_generation') {
                        resultHTML += `<button onclick="downloadCode(\`${escOutput.replace(/`/g, '\\`')}\`, 'cogniware_generated.py')" 
                                        style="padding: 8px 16px; background: #2d862d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                                        üíæ Download
                                       </button>`;
                    }
                    
                    resultHTML += `
                                </div>
                            </div>
                            <pre style="background: #1e1e1e; color: #d4d4d4; padding: 20px; border-radius: 8px; overflow-x: auto; font-size: 14px; line-height: 1.7; margin: 0;">${escOutput}</pre>
                        </div>
                    `;
                    
                    document.getElementById(config.result).innerHTML = resultHTML;
                } else {
                    document.getElementById(config.result).innerHTML = `
                        <div class="message-error" style="margin-top: 20px;">
                            <span style="font-size: 24px;">‚ùå</span>
                            <div>
                                <strong>Processing Failed</strong>
                                <p style="margin: 4px 0 0 0;">${nlResult.error || 'Unknown error occurred'}</p>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                window.nlVisualizer.showResult({
                    success: false,
                    error: error.message
                });
                
                document.getElementById(config.result).innerHTML = `
                    <div style="padding: 16px; background: #fee; border-radius: 8px; color: #c33;">
                        ‚ùå Error: ${error.message}
                    </div>
                `;
            } finally {
                // Re-enable button
                buttonElement.disabled = false;
                buttonElement.classList.remove('btn-processing');
                buttonElement.innerHTML = originalText;
            }
        }
        
        async function executeActionPlan(plan, resultElementId) {
            if (!plan || !plan.steps || plan.steps.length === 0) {
                displayError(resultElementId, 'No execution steps generated');
                return;
            }
            
            // Execute steps in sequence
            for (const step of plan.steps) {
                const [method, endpoint] = step.api.split(' ');
                
                try {
                    const result = await apiCall(endpoint, method, step.params);
                    displayResult(resultElementId, result);
                } catch (error) {
                    displayError(resultElementId, error.message);
                }
            }
        }
        
        // Check LLM availability on load
        setTimeout(checkLLMAvailability, 2000);
    </script>
    <script src="parallel-llm-visualizer-enhanced.js"></script>
    <script src="workspace-examples.js"></script>
    <script>
        // Initialize examples when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('User Portal: DOM loaded, initializing examples...');
            console.log('renderExamplesSection function available?', typeof renderExamplesSection);
            
            // Add examples to each workspace after a brief delay to ensure DOM is ready
            setTimeout(function() {
                const modules = ['code_generation', 'browser', 'database', 'documents'];
                modules.forEach(module => {
                    const examplesDivId = module.replace('_', '') + 'Examples';
                    const examplesDiv = document.getElementById(examplesDivId);
                    console.log(`Module: ${module}, Div ID: ${examplesDivId}, Found: ${!!examplesDiv}`);
                    
                    if (examplesDiv && typeof renderExamplesSection === 'function') {
                        try {
                            examplesDiv.innerHTML = renderExamplesSection(module);
                            console.log(`‚úÖ Successfully rendered examples for ${module}`);
                        } catch (error) {
                            console.error(`‚ùå Error rendering ${module}:`, error);
                        }
                    } else {
                        if (!examplesDiv) console.error(`‚ùå Div ${examplesDivId} not found`);
                        if (typeof renderExamplesSection !== 'function') console.error(`‚ùå renderExamplesSection is not a function`);
                    }
                });
            }, 100);
        });
        
        // Initialize parallel LLM visualizers for each module
        window.addEventListener('DOMContentLoaded', function() {
            // Visualizers will be created on demand in processNaturalLanguage function
            console.log('Parallel LLM Visualizer loaded and ready');
        });
    </script>
</body>
</html>

